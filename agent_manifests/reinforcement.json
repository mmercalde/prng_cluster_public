{
  "agent_name": "reinforcement_agent",
  "description": "Step 5: Train ML models with anti-overfitting measures. Emits signal_quality to sidecar for Step 6 gate.",
  "pipeline_step": 5,
  "version": "1.8.0",
  "required_inputs": [
    "survivors_with_scores.json",
    "train_history.json",
    "reinforcement_engine_config.json"
  ],
  "primary_output": "models/reinforcement/best_model.meta.json",
  "inputs": [
    {
      "name": "survivors_with_scores",
      "file_pattern": "survivors_with_scores.json",
      "required": true,
      "description": "Scored survivors with features and holdout_hits"
    },
    {
      "name": "train_history",
      "file_pattern": "train_history.json",
      "required": true,
      "description": "Training lottery draws"
    }
  ],
  "outputs": [
    {
      "name": "model_checkpoint",
      "file_pattern": "models/reinforcement/best_model.*",
      "required": true,
      "description": "Trained model checkpoint"
    },
    {
      "name": "model_sidecar",
      "file_pattern": "models/reinforcement/best_model.meta.json",
      "required": true,
      "description": "Model metadata with signal_quality"
    }
  ],
  "signal_quality_emission": {
    "description": "Step 5 computes and emits signal_quality to sidecar",
    "destination": "best_model.meta.json:signal_quality",
    "computed_from": "holdout_hits target distribution"
  },
  "autonomy_boundaries": {
    "step_5_authority": [
      "Train ML models",
      "Compute signal_quality (SINGLE SOURCE OF TRUTH)",
      "Emit to sidecar"
    ],
    "step_5_does_NOT": [
      "Decide whether Step 6 proceeds",
      "Override WATCHER_AGENT"
    ]
  },
  "parameter_bounds": {
    "model_type": {
      "type": "categorical",
      "values": [
        "neural_net",
        "xgboost",
        "lightgbm",
        "catboost",
        "random_forest"
      ],
      "default": "neural_net"
    },
    "compare_models": {
      "type": "bool",
      "default": false
    },
    "trials": {
      "type": "int",
      "min": 10,
      "max": 200,
      "default": 50
    },
    "enable_diagnostics": {
      "type": "bool",
      "default": false
    },
    "normalize_features": {
      "type": "bool",
      "default": true,
      "description": "Category B: StandardScaler input normalization for NN (Option A: default ON)"
    },
    "use_leaky_relu": {
      "type": "bool",
      "default": true,
      "description": "Category B: LeakyReLU(0.01) activation for NN (default ON)"
    },
    "dropout_override": {
      "type": "float",
      "min": 0.0,
      "max": 0.9,
      "default": null,
      "description": "Category B: NN dropout override (preferred key for WATCHER retry payloads)"
    },
    "dropout": {
      "type": "float",
      "min": 0.0,
      "max": 0.9,
      "default": null,
      "description": "Category B: Alias for dropout_override (matches CLI --dropout). Phase 2 reads both."
    },
    "persistent_workers": {
      "type": "bool",
      "default": false,
      "description": "[S96B] Persistent GPU workers for NN trials (5-10x speedup)"
    },
    "batch_size_nn": {
      "type": "int",
      "min": 1,
      "max": 32,
      "default": 1,
      "description": "[Phase 3A] vmap batch size for NN trials inside persistent GPU worker. Default 1 = serial (kill-switch OFF). Set to 16 after Zeus smoke test passes. Only active when model_type=neural_net AND persistent_workers=true. torch.func.vmap is beta \u2014 treat as feature-flag rollout."
    }
  },
  "follow_up_agents": [
    "prediction_agent"
  ],
  "version_history": [
    {
      "version": "1.5.0",
      "date": "2026-01-01",
      "changes": [
        "Added signal_quality emission"
      ]
    },
    {
      "version": "1.6.0",
      "date": "2026-02-15",
      "changes": [
        "Category B: Added normalize_features, use_leaky_relu parameter bounds (default ON)",
        "Category B: Added dropout_override + dropout alias for NN training override",
        "Fix 3B-1: Both dropout_override (preferred) and dropout (alias) declared for consistency"
      ]
    },
    {
      "version": "1.7.0",
      "date": "2026-02-19",
      "changes": [
        "S96B: Added persistent_workers param (default OFF, pass true to enable)"
      ]
    },
    {
      "version": "1.8.0",
      "date": "2026-02-19",
      "changes": [
        "Phase 3A: Added batch_size_nn param (default 1=off, max 32). Feature-flag for vmap batched NN trials in persistent GPU worker. Enable by setting batch_size_nn=16 after Zeus smoke test passes."
      ]
    }
  ],
  "evaluation_type": "file_exists",
  "success_condition": [
    "models/reinforcement/best_model.meta.json"
  ],
  "disable_llm_parsing": true,
  "disable_heuristic_parsing": true,
  "retry_policy": "none",
  "default_params": {
    "survivors": "survivors_with_scores.json",
    "lottery_data": "train_history.json",
    "compare_models": true,
    "trials": 20,
    "output_dir": "models/reinforcement",
    "enable_diagnostics": true,
    "model_type": "catboost",
    "persistent_workers": false,
    "batch_size_nn": 1
  }
}